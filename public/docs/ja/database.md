# データベースクライアント

Marix には、アプリケーションから直接データベースサーバーに接続して管理するための内蔵データベースクライアントが含まれています。

## データベースクライアントインターフェース

![Database Client Interface](/database.png)

---

## 対応データベース

| データベース | プロトコル | 機能 |
|----------|----------|----------|
| **MySQL / MariaDB** | `mysql` | クエリエディター、テーブルブラウザ、データビューアー、構造インスペクター |
| **PostgreSQL** | `postgresql` | クエリエディター、テーブルブラウザ、データビューアー、構造インスペクター |
| **MongoDB** | `mongodb` | コレクションブラウザ、ドキュメントビューアー、クエリインターフェース |
| **Redis** | `redis` | キーバリューブラウザ、コマンドインターフェース |
| **SQLite** | `sqlite` | ローカルファイルサポート、フル SQL エディター |

---

## データベースサーバーを追加

1. サイドバーの **+ Add** ボタンをクリック
2. **Database** タブ（またはデータベースアイコン）を選択
3. データベースタイプを選択

### MySQL / MariaDB / PostgreSQL

| フィールド | 説明 | 例 |
|-------|-------------|---------|
| 名前 | 表示名 | `Production MySQL` |
| ホスト | サーバーのホスト名または IP | `db.example.com` |
| ポート | データベースポート | `3306`（MySQL）/ `5432`（PostgreSQL） |
| ユーザー名 | データベースユーザー | `root` |
| パスワード | ユーザーパスワード | `••••••••` |
| データベース | デフォルトデータベース（オプション） | `myapp_production` |
| SSL | SSL/TLS を有効化 | ☑️ 有効 |

### MongoDB

| フィールド | 説明 | 例 |
|-------|-------------|---------|
| 名前 | 表示名 | `MongoDB Atlas` |
| 接続文字列 | フル MongoDB URI | `mongodb+srv://user:pass@cluster.mongodb.net/` |
| ホスト | サーバーホスト名 | `localhost` |
| ポート | MongoDB ポート | `27017` |
| データベース | デフォルトデータベース | `myapp` |

### Redis

| フィールド | 説明 | 例 |
|-------|-------------|---------|
| 名前 | 表示名 | `Redis Cache` |
| ホスト | サーバーホスト名 | `redis.example.com` |
| ポート | Redis ポート | `6379` |
| パスワード | 認証パスワード（オプション） | `••••••••` |
| データベース | データベース番号 | `0` |

### SQLite

| フィールド | 説明 | 例 |
|-------|-------------|---------|
| 名前 | 表示名 | `Local SQLite` |
| ファイルパス | .db ファイルのパス | `/home/user/app.db` |

---

## データベースクライアントインターフェース

### 📊 データタブ

テーブルデータを閲覧・表示:

- ドロップダウンから**データベースを選択**（複数ある場合）
- サイドバーで**テーブルをクリック**してデータを表示
- **ページネーション** - 行を移動（デフォルト100件ごと）
- **列ソート** - 列ヘッダーをクリックしてソート
- **クイックフィルター** - 表示されたデータ内を検索

### ⚡ クエリタブ

SQL クエリを記述・実行:

- **シンタックスハイライト** - SQL キーワード、文字列、数値
- **実行** - `Ctrl+Enter` または実行ボタンでクエリを実行
- **結果グリッド** - テーブルでクエリ結果を表示
- **エクスポート** - 結果を CSV または JSON でダウンロード
- **実行時間** - クエリにかかった時間を確認

### 🏗️ 構造タブ

テーブルスキーマを検査:

- 列名とデータ型
- プライマリキー、外部キー、ユニーク制約
- NULL 許可列とデフォルト値
- オートインクリメント設定

### 🔗 ERD タブ

ER 図を表示:

- テーブルとリレーションシップの視覚的表現
- 外部キー接続を線で表示
- 大きなスキーマをドラッグ＆ズームでナビゲート
- 画像（PNG）としてエクスポート

---

## キーボードショートカット

| ショートカット | アクション |
|----------|--------|
| `Ctrl/Cmd + Enter` | クエリを実行 |
| `Ctrl/Cmd + S` | クエリをファイルに保存 |
| `Ctrl/Cmd + O` | ファイルからクエリを開く |
| `Ctrl/Cmd + Shift + F` | SQL をフォーマット |
| `Escape` | 実行中のクエリをキャンセル |

---

## 接続セキュリティ

### SSL/TLS 暗号化

サーバー追加時に **SSL** チェックボックスを有効化。カスタム証明書の場合:

- CA 証明書パス
- クライアント証明書パス（オプション）
- クライアントキーパス（オプション）

### SSH トンネル

SSH トンネル経由で接続:

1. まず Marix に SSH サーバーを追加
2. データベース追加時に **SSH Tunnel** を有効化
3. トンネル経由で使用する SSH サーバーを選択

---

## ベストプラクティス

1. **読み取り専用アカウントを使用** - 制限された権限のデータベースユーザーを作成
2. **結果セットを制限** - 大量のデータを読み込まないよう常に `LIMIT` を使用
3. **実行前にテスト** - `UPDATE` や `DELETE` の前に、まず `SELECT` を実行
4. **トランザクションを使用** - 重要な操作はトランザクションでラップ

---

## トラブルシューティング

| 問題 | 解決策 |
|-------|----------|
| 接続失敗 | ホスト/ポート、認証情報、ファイアウォール、SSL 設定を確認 |
| クエリタイムアウト | LIMIT を追加、インデックスを確認、サーバー負荷を確認 |
| 権限拒否 | 権限付与、データベースアクセス、管理者に連絡 |
| SSL 証明書エラー | SSL を無効化、証明書の有効性を確認、CA 証明書を追加 |
