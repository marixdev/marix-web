# WebSocket クライアント

リアルタイム双方向通信のために WebSocket サーバーに接続します。API テスト、ライブフィードのデバッグ、または WebSocket サービスの監視に最適です。

## WebSocket クライアントインターフェース

![WebSocket Interface](/websocket.png)

## WebSocket サーバーを追加

1. **「Add New Host」** をクリック
2. **プロトコル**: WebSocket (WSS) を選択
3. 以下を入力:
   - **名前**: 接続の表示名
   - **URL**: WebSocket サーバーアドレス
   - **ヘッダー**: （オプション）認証用のカスタムヘッダー
4. **Create** をクリック

### URL 形式

| 形式 | 例 |
|--------|---------|
| プロトコル付き | `wss://api.example.com/ws` |
| プロトコルなし | `api.example.com/ws`（自動的に `wss://` を追加） |
| ポート付き | `wss://localhost:8080/socket` |
| パス付き | `wss://stream.example.com/v1/feed` |

> **注意:** プロトコルが指定されていない場合、Marix は安全な WebSocket 接続のために自動的に `wss://` を追加します。

## 接続

1. ホストリストの WebSocket サーバーをダブルクリック
2. 接続を待つ（タイムアウト: 15秒）
3. ステータスインジケーターで接続状態を表示

### 接続ステータス

| ステータス | インジケーター | 説明 |
|--------|-----------|-------------|
| 接続中 | 🟡 黄色 | 接続を確立中 |
| 接続済み | 🟢 緑 | 送受信準備完了 |
| 切断 | ⚪ グレー | 接続終了 |
| エラー | 🔴 赤 | 接続失敗 |

## メッセージを送信

1. 下部の入力エリアにメッセージを入力
2. **Enter** を押すか **Send** をクリック
3. 送信メッセージは ↑ 矢印（緑）で表示

### 対応メッセージ形式

- プレーンテキスト
- JSON（読みやすくフォーマットされます）
- 任意の文字列データ

## メッセージを受信

- 受信メッセージは ↓ 矢印（紫）で自動的に表示
- JSON メッセージは適切なインデントで自動フォーマット
- タイムスタンプで各メッセージの受信時刻を表示
- メッセージ履歴はセッションごとに最大1000件を保持

## コントロール

| コントロール | 機能 |
|---------|----------|
| **Send** | サーバーにメッセージを送信 |
| **Clear** | 表示からすべてのメッセージをクリア |
| **Disconnect** | 接続を閉じる |
| **Reconnect** | 切断/エラー後に再接続 |
| **テーマセレクター** | ビューアーの配色を変更 |

## キーボードショートカット

| ショートカット | アクション |
|----------|--------|
| `Enter` | メッセージを送信 |
| `Shift+Enter` | メッセージ内で改行 |

## 機能

### 自動スクロール

- デフォルトで有効
- 最新のメッセージに自動スクロール
- オフにして古いメッセージを確認
- 下部にメッセージ数を表示

### テーマサポート

- 400以上のターミナルテーマが利用可能
- ヘッダーのテーマセレクターをクリック
- テーマはビューアー全体に適用
- 色はライト/ダークテーマに適応

### JSON フォーマット

JSON メッセージを受信した場合:
```json
{"event":"update","data":{"id":1,"value":"test"}}
```

Marix は自動的に以下のようにフォーマットします:
```json
{
  "event": "update",
  "data": {
    "id": 1,
    "value": "test"
  }
}
```

## ユースケース

### API テスト

開発中の WebSocket API をテスト:
- テストペイロードを送信
- レスポンスを監視
- 接続の問題をデバッグ

### ライブデータ監視

リアルタイムフィードを監視:
- 株価の更新
- チャットアプリケーション
- IoT センサーデータ
- ゲームサーバーイベント

### デバッグ

WebSocket 実装をデバッグ:
- メッセージ形式を確認
- 接続の安定性を確認
- 再接続ロジックをテスト

## トラブルシューティング

### 接続タイムアウト

- URL が正しいか確認
- サーバーが起動しているか確認
- ファイアウォール/プロキシ設定を確認
- 明示的な `wss://` プロトコルで試す

### 接続拒否

- サーバーが接続を受け入れていない可能性
- 間違ったポート番号
- SSL/TLS 証明書の問題
- サーバーが認証ヘッダーを必要としている可能性

### メッセージが送信されない

- 接続ステータスが「接続済み」か確認
- メッセージ形式がサーバーの期待に一致しているか確認
- サーバーログでエラーを確認

### 予期せず切断

- サーバーが接続を閉じた可能性
- ネットワーク中断
- サーバー側のアイドルタイムアウト
- **Reconnect** をクリックして接続を復元
