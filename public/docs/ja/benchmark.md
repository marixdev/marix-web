# サーバーベンチマーク

SSH ターミナルから直接サーバーのパフォーマンスをテストし、システム、ディスク、ネットワークの包括的なベンチマークを測定します。

## サーバーベンチマークインターフェース

![サーバーベンチマークインターフェース](/benchmark.png)

## 概要

サーバーベンチマーク機能は、リモートサーバーの完全なパフォーマンス分析を提供します：

- **システム情報**：ハードウェアとソフトウェアの詳細
- **ディスクパフォーマンス**：シーケンシャル読み書き速度、I/O レイテンシ、ランダム IOPS
- **ネットワーク速度**：ダウンロード、アップロード、レイテンシ測定を含むマルチリージョン速度テスト

## 使用方法

### ベンチマークの開始

1. SSH でサーバーに接続
2. ターミナルフッターの **📊 Benchmark** ボタンをクリック
3. （オプション）**"Upload to paste.dev"** にチェックを入れて結果をオンラインで共有
4. **Start Benchmark** をクリック

### ベンチマークフェーズ

ベンチマークは 4 つのフェーズで実行されます：

| フェーズ | 説明 | 所要時間 |
|----------|------|----------|
| 1. システム情報 | OS、CPU、RAM、ディスク情報を収集 | 約 2 秒 |
| 2. ディスクテスト | dd、ioping、fio テストを実行 | 約 45 秒 |
| 3. ネットワークテスト | 18 のグローバルリージョンへの速度をテスト | 約 3-5 分 |
| 4. 完了 | 結果とエクスポートオプションを表示 | - |

## ベンチマーク詳細

### システム情報

収集されるデータ：

| フィールド | 説明 |
|------------|------|
| OS | オペレーティングシステム名とバージョン |
| Kernel | Linux カーネルバージョン |
| Architecture | CPU アーキテクチャ（x86_64、arm64 など） |
| Hostname | サーバーホスト名 |
| CPU Model | プロセッサ名と仕様 |
| CPU Cores | CPU コア数 |
| CPU Frequency | 現在の CPU 周波数 |
| Memory | 使用中 / 総 RAM |
| Swap | 使用中 / 総スワップ領域 |
| Disk | 使用中 / 総ディスク容量 |
| Uptime | サーバー稼働時間 |
| Load Average | 1/5/15 分間の平均負荷 |
| Virtualization | VM タイプ（KVM、VMware、OpenVZ など） |

### ディスクパフォーマンス

#### シーケンシャル書き込み/読み取り (dd)

- **方法**：`dd if=/dev/zero of=test bs=64k count=16k conv=fdatasync`
- **実行回数**：3 回、精度のため平均化
- **テスト場所**：ホームディレクトリ（tmpfs を避けるため /tmp ではない）
- **測定**：MB/s または GB/s でのシーケンシャルスループット

#### I/O レイテンシ (ioping)

- **方法**：`ioping -c 10 -q /`
- **測定**：マイクロ秒単位のディスク I/O 応答時間
- **対象**：実際のディスクレイテンシを取得するためのルートファイルシステム

#### ランダム 4K IOPS (fio)

- **方法**：4K ランダム読み書き、キュー深度 64 の fio
- **実行時間**：30 秒
- **測定**：
  - Read IOPS
  - Write IOPS
  - Read Bandwidth
  - Write Bandwidth

> **注意**：`fio` または `ioping` がインストールされていない場合、ベンチマークは自動的にインストールを試みます。

### ネットワーク速度

テストは 18 のグローバルリージョンの Speedtest.net サーバーに対して実行されます：

| リージョン | 場所 |
|------------|------|
| アジア | シンガポール、東京、香港、ソウル、ムンバイ |
| ヨーロッパ | ロンドン、フランクフルト、パリ、アムステルダム |
| アメリカ | ロサンゼルス、ニューヨーク、シカゴ、トロント、サンパウロ |
| オセアニア | シドニー、オークランド |
| 中東/アフリカ | ドバイ、ヨハネスブルグ |

各サーバーに対して、ベンチマークは以下を測定します：
- **ダウンロード速度**：MB/s または Gbps
- **アップロード速度**：MB/s または Gbps
- **レイテンシ**：ミリ秒単位のラウンドトリップ時間

## エクスポートオプション

ベンチマーク完了後、複数の形式で結果をエクスポートできます：

### 🌐 HTML

スタイル付きレイアウトのスタンドアロン HTML ファイル。特徴：
- ダークテーマデザイン
- レスポンシブレイアウト
- すべてのベンチマークデータをカード形式で表示
- marix.dev と GitHub リンク付きフッター

### 📋 JSON

構造化された JSON データ：
- 完全なベンチマーク結果
- タイムスタンプ
- ウェブサイトと GitHub リンクを含むメタオブジェクト
- 自動化のための機械可読形式

### 🖼️ PNG

高解像度画像スクリーンショット：
- Retina ディスプレイ用の 2 倍スケール
- RGB カラー（html2canvas 互換）
- すべてのセクションを含む
- ブランディング付きフッター

### 📄 TXT

ASCII アート形式のテキストファイル：
- テーブル用の罫線文字
- コピー＆ペーストに便利
- ターミナルスタイルの出力
- リンク付きフッター

## paste.dev 統合

ワンクリックでベンチマーク結果をオンラインで共有：

### 仕組み

1. ベンチマーク開始前に **"Upload to paste.dev"** にチェック
2. ベンチマークを実行
3. 完了後、結果が自動的にアップロード
4. **Copy** と **Open** ボタン付きの共有可能なリンクが表示

### 機能

- **自動アップロード**：ベンチマーク完了時に TXT 形式がアップロード
- **リンクをコピー**：📋 Copy をクリックして URL をクリップボードにコピー
- **リンクを開く**：🔗 Open をクリックしてブラウザで表示
- **公開共有**：リンクを持つ誰でも結果を表示可能

## 要件

### サーバー要件

| ツール | 目的 | 自動インストール |
|--------|------|------------------|
| `dd` | ディスク書き込み/読み取り速度 | 通常プリインストール |
| `ioping` | I/O レイテンシ測定 | ✅ はい |
| `fio` | ランダム IOPS テスト | ✅ はい |
| `curl` | ネットワーク速度テスト | 通常プリインストール |

### サポートされているパッケージマネージャー

自動インストールは以下で動作します：
- **apt**（Debian、Ubuntu）
- **yum**（CentOS、RHEL）
- **dnf**（Fedora）
- **pacman**（Arch Linux）
- **apk**（Alpine Linux）
- **zypper**（openSUSE）

## トラブルシューティング

### ディスクテストで非現実的な速度が表示される（5+ GB/s）

**原因**：`/tmp` が tmpfs（RAM ディスク）としてマウントされている

**解決策**：ベンチマークはこれを自動的に検出し、代わりにホームディレクトリを使用します。

### ネットワークテストに時間がかかりすぎる

**原因**：一部のリージョンが遅いか到達不能

**解決策**：ベンチマークは複数のリージョンをテストします。遅いリージョンは 30 秒後にタイムアウトします。

### ツールのインストール時に「Permission Denied」エラー

**原因**：ユーザーに sudo アクセス権がない

**解決策**：サーバー管理者に `fio` と `ioping` のインストールを依頼してください：

```bash
# Debian/Ubuntu
sudo apt install fio ioping

# CentOS/RHEL
sudo yum install fio ioping

# Fedora
sudo dnf install fio ioping
```

### PNG エクスポートエラー「oklch」

**原因**：html2canvas は oklch カラーフォーマットをサポートしていない

**解決策**：v1.0.19 で修正済み。PNG は現在 RGB 16 進数カラーを使用しています。

## 出力例

### TXT フォーマットサンプル

```
════════════════════════════════════════════════════════════
  MARIX SERVER BENCHMARK - my-server.com
  1/29/2026, 10:30:45 AM
════════════════════════════════════════════════════════════

┌────────────────────────────────────────────────────────────┐
│                    SYSTEM INFORMATION                      │
└────────────────────────────────────────────────────────────┘
  OS            : Ubuntu 22.04.3 LTS
  CPU           : AMD EPYC 7B13 64-Core Processor
  CPU Cores     : 4
  Memory        : 2.1 GB / 8.0 GB (26%)
  Disk          : 45 GB / 160 GB (28%)
  Virtualization: KVM

┌────────────────────────────────────────────────────────────┐
│                    DISK PERFORMANCE                        │
└────────────────────────────────────────────────────────────┘
  Sequential Write : 580 MB/s
  Sequential Read  : 1.2 GB/s
  I/O Latency      : 227 µs

  Random 4K IOPS (fio):
    Read IOPS   : 45,230
    Write IOPS  : 15,076
    Read BW     : 176.7 MB/s
    Write BW    : 58.9 MB/s

┌────────────────────────────────────────────────────────────┐
│                    NETWORK SPEED                           │
└────────────────────────────────────────────────────────────┘
  Singapore    : ↓ 892 Mbps  ↑ 456 Mbps  (12ms)
  Tokyo        : ↓ 756 Mbps  ↑ 389 Mbps  (45ms)
  Frankfurt    : ↓ 234 Mbps  ↑ 178 Mbps  (156ms)
  ...

────────────────────────────────────────────────────────────
  marix.dev | https://github.com/marixdev/marix
  Generated by Marix SSH Client v1.0.19
────────────────────────────────────────────────────────────
```

## セキュリティに関する注意

- ベンチマークは SSH 経由でリモートサーバー上でコマンドを実行します
- Speedtest.net（速度テスト用）を除き、外部サーバーにデータは送信されません
- paste.dev へのアップロードはオプションで、ユーザーが開始します
- 一時テストファイルはベンチマーク後に自動的にクリーンアップされます
