# コマンド履歴（コマンドリコール）

Marix は、各サーバーで以前に実行したコマンドを保存して呼び出す**コマンド履歴**機能を提供します。これにより、再入力せずに一般的なコマンドをすばやく再実行できます。

## コマンド履歴インターフェース

![Command History Interface](/cmh.png)

## 機能

- **サーバーごとの履歴**: 各サーバーが独自のコマンド履歴を維持
- **ローカルストレージのみ**: コマンドはローカルに保存され、同期やバックアップはされない
- **機密データのフィルタリング**: パスワード、トークン、シークレットを含むコマンドを自動的にフィルター
- **LRU プルーニング**: 古いコマンドを自動的に削除（サーバーあたり最大50件）
- **実行カウンター**: 各コマンドの使用回数を追跡
- **検索**: あいまい検索でコマンドをすばやくフィルター

## 有効にする方法

コマンド履歴はプライバシーのため**デフォルトで無効**です。有効にするには:

1. **設定**（サイドバーの歯車アイコン）を開く
2. **Terminal** セクションに移動
3. **Enable Command Recall** をトグル

## 使用法

### コマンド履歴を開く

ターミナルセッション中に以下を押す:
- ターミナル入力が空の場合（カーソルが空行にある場合）に **`Tab`** キー
- またはターミナルツールバーの **History** ボタンをクリック

### キーボードショートカット

| キー | アクション |
|-----|--------|
| `Tab`（空の入力） | コマンドリコールポップアップを開く |
| `↑` / `↓` | コマンドをナビゲート |
| `Enter` | 選択したコマンドを実行 |
| `Escape` | ポップアップを閉じる |
| `Delete` / `Backspace` | 選択したコマンドを削除 |

### ポップアップアクション

- コマンドを**クリック**して即座に実行
- 検索ボックスに入力して**検索**
- ゴミ箱アイコンで個別のコマンドを**削除**
- コマンドを再利用可能なスニペットに変換するために**スニペットとして保存**

## プライバシーとセキュリティ

### フィルターされるコマンド

以下のパターンに一致するコマンドは**保存されません**:

- `password`、`passwd`、`secret`、`token` を含むコマンド
- `api_key` または `apikey` を含むコマンド
- `-p` フラグ（パスワード）を持つ MySQL コマンド
- `sudo -S`（標準入力パスワード）
- パスワード付きの `sshpass` または `expect` を使用するコマンド
- 機密値を持つ環境変数のエクスポート

### データストレージ

- ブラウザの `localStorage` に保存
- クラウドサービスに**同期されない**
- バックアップに**含まれない**
- ブラウザデータをクリアすると消去

### 履歴をクリア

コマンド履歴をクリアするには:

1. **設定** → **Terminal** を開く
2. **Clear Command History** をクリック

またはコマンドリコールポップアップからサーバーごとにクリア。

## 制限

| 制限 | 値 |
|-------|-------|
| サーバーあたりの最大コマンド数 | 50 |
| 最小コマンド長 | 2文字 |

## FAQ

### なぜ一部のコマンドが保存されないのですか？

機密パターン（パスワード、トークンなど）を含むコマンドは、セキュリティのため自動的にフィルターされます。

### コマンド履歴をエクスポートできますか？

いいえ、コマンド履歴はプライバシー上の理由から意図的にローカル専用で、エクスポートできません。

### コマンド履歴はデバイス間で同期されますか？

いいえ、コマンド履歴はローカルに保存され、同期されることはありません。
