# การทดสอบประสิทธิภาพเซิร์ฟเวอร์

ทดสอบและวัดประสิทธิภาพเซิร์ฟเวอร์ของคุณโดยตรงจากเทอร์มินัล SSH ด้วยการทดสอบระบบ ดิสก์ และเครือข่ายอย่างครอบคลุม

## อินเทอร์เฟซการทดสอบประสิทธิภาพเซิร์ฟเวอร์

![อินเทอร์เฟซการทดสอบประสิทธิภาพเซิร์ฟเวอร์](/benchmark.png)

## ภาพรวม

ฟีเจอร์การทดสอบประสิทธิภาพเซิร์ฟเวอร์ให้การวิเคราะห์ประสิทธิภาพอย่างครบถ้วนของเซิร์ฟเวอร์ระยะไกลของคุณ รวมถึง:

- **ข้อมูลระบบ**: รายละเอียดฮาร์ดแวร์และซอฟต์แวร์
- **ประสิทธิภาพดิสก์**: ความเร็วอ่าน/เขียนตามลำดับ, เวลาแฝง I/O และ IOPS แบบสุ่ม
- **ความเร็วเครือข่าย**: การทดสอบความเร็วหลายภูมิภาคพร้อมการวัดดาวน์โหลด อัปโหลด และเวลาแฝง

## วิธีใช้งาน

### เริ่มการทดสอบประสิทธิภาพ

1. เชื่อมต่อกับเซิร์ฟเวอร์ผ่าน SSH
2. คลิกปุ่ม **📊 Benchmark** ที่ส่วนท้ายของเทอร์มินัล
3. (ไม่บังคับ) เลือก **"Upload to paste.dev"** เพื่อแชร์ผลลัพธ์ออนไลน์
4. คลิก **Start Benchmark**

### ขั้นตอนการทดสอบ

การทดสอบประสิทธิภาพทำงานใน 4 ขั้นตอน:

| ขั้นตอน | คำอธิบาย | ระยะเวลา |
|---------|----------|----------|
| 1. ข้อมูลระบบ | รวบรวมข้อมูล OS, CPU, RAM, ดิสก์ | ~2 วินาที |
| 2. ทดสอบดิสก์ | รัน dd, ioping และ fio tests | ~45 วินาที |
| 3. ทดสอบเครือข่าย | ทดสอบความเร็วไปยัง 18 ภูมิภาคทั่วโลก | ~3-5 นาที |
| 4. เสร็จสิ้น | แสดงผลลัพธ์และตัวเลือกส่งออก | - |

## รายละเอียดการทดสอบ

### ข้อมูลระบบ

ข้อมูลที่รวบรวมรวมถึง:

| ฟิลด์ | คำอธิบาย |
|-------|----------|
| OS | ชื่อและเวอร์ชันระบบปฏิบัติการ |
| Kernel | เวอร์ชัน Linux kernel |
| Architecture | สถาปัตยกรรม CPU (x86_64, arm64 ฯลฯ) |
| Hostname | ชื่อโฮสต์เซิร์ฟเวอร์ |
| CPU Model | ชื่อและข้อมูลจำเพาะของโปรเซสเซอร์ |
| CPU Cores | จำนวนคอร์ CPU |
| CPU Frequency | ความถี่ CPU ปัจจุบัน |
| Memory | RAM ที่ใช้ / ทั้งหมด |
| Swap | พื้นที่ swap ที่ใช้ / ทั้งหมด |
| Disk | พื้นที่ดิสก์ที่ใช้ / ทั้งหมด |
| Uptime | เวลาทำงานของเซิร์ฟเวอร์ |
| Load Average | ค่าเฉลี่ยโหลด 1/5/15 นาที |
| Virtualization | ประเภท VM (KVM, VMware, OpenVZ ฯลฯ) |

### ประสิทธิภาพดิสก์

#### เขียน/อ่านตามลำดับ (dd)

- **วิธีการ**: `dd if=/dev/zero of=test bs=64k count=16k conv=fdatasync`
- **จำนวนครั้ง**: 3 ครั้ง หาค่าเฉลี่ยเพื่อความแม่นยำ
- **ตำแหน่งทดสอบ**: ไดเรกทอรี home (ไม่ใช่ /tmp เพื่อหลีกเลี่ยง tmpfs)
- **วัด**: ปริมาณงานตามลำดับใน MB/s หรือ GB/s

#### เวลาแฝง I/O (ioping)

- **วิธีการ**: `ioping -c 10 -q /`
- **วัด**: เวลาตอบสนอง I/O ของดิสก์ในหน่วยไมโครวินาที
- **เป้าหมาย**: ระบบไฟล์รูทเพื่อวัดเวลาแฝงดิสก์จริง

#### IOPS แบบสุ่ม 4K (fio)

- **วิธีการ**: fio ด้วยอ่าน/เขียนแบบสุ่ม 4K ความลึกคิว 64
- **เวลาทำงาน**: 30 วินาที
- **วัด**:
  - Read IOPS
  - Write IOPS
  - Read Bandwidth
  - Write Bandwidth

> **หมายเหตุ**: หาก `fio` หรือ `ioping` ไม่ได้ติดตั้ง การทดสอบประสิทธิภาพจะพยายามติดตั้งอัตโนมัติ

### ความเร็วเครือข่าย

การทดสอบดำเนินการกับเซิร์ฟเวอร์ Speedtest.net ใน 18 ภูมิภาคทั่วโลก:

| ภูมิภาค | ตำแหน่ง |
|---------|---------|
| เอเชีย | สิงคโปร์ โตเกียว ฮ่องกง โซล มุมไบ |
| ยุโรป | ลอนดอน แฟรงก์เฟิร์ต ปารีส อัมสเตอร์ดัม |
| อเมริกา | ลอสแอนเจลิส นิวยอร์ก ชิคาโก โตรอนโต เซาเปาโล |
| โอเชียเนีย | ซิดนีย์ โอ๊คแลนด์ |
| ตะวันออกกลาง/แอฟริกา | ดูไบ โจฮันเนสเบิร์ก |

สำหรับแต่ละเซิร์ฟเวอร์ การทดสอบวัด:
- **ความเร็วดาวน์โหลด**: MB/s หรือ Gbps
- **ความเร็วอัปโหลด**: MB/s หรือ Gbps
- **เวลาแฝง**: เวลาไป-กลับในหน่วยมิลลิวินาที

## ตัวเลือกส่งออก

หลังจากการทดสอบเสร็จสิ้น คุณสามารถส่งออกผลลัพธ์ในหลายรูปแบบ:

### 🌐 HTML

ไฟล์ HTML แบบสแตนด์อโลนพร้อมเลย์เอาต์ที่มีสไตล์ คุณสมบัติ:
- ดีไซน์ธีมมืด
- เลย์เอาต์ตอบสนอง
- ข้อมูลการทดสอบทั้งหมดในการ์ด
- ส่วนท้ายพร้อมลิงก์ marix.dev และ GitHub

### 📋 JSON

ข้อมูล JSON ที่มีโครงสร้างพร้อม:
- ผลการทดสอบที่สมบูรณ์
- Timestamps
- Meta object พร้อมลิงก์เว็บไซต์และ GitHub
- รูปแบบที่เครื่องอ่านได้สำหรับการทำงานอัตโนมัติ

### 🖼️ PNG

ภาพหน้าจอความละเอียดสูง:
- สเกล 2x สำหรับจอ retina
- สี RGB (รองรับ html2canvas)
- รวมทุกส่วน
- ส่วนท้ายพร้อมแบรนด์

### 📄 TXT

ไฟล์ข้อความรูปแบบ ASCII art:
- อักขระวาดกล่องสำหรับตาราง
- คัดลอก-วางได้ง่าย
- เอาต์พุตสไตล์เทอร์มินัล
- ส่วนท้ายพร้อมลิงก์

## การรวม paste.dev

แชร์ผลการทดสอบของคุณออนไลน์ด้วยคลิกเดียว:

### วิธีการทำงาน

1. เลือก **"Upload to paste.dev"** ก่อนเริ่มการทดสอบ
2. รันการทดสอบ
3. หลังจากเสร็จสิ้น ผลลัพธ์จะถูกอัปโหลดอัตโนมัติ
4. ลิงก์แชร์ได้จะปรากฏพร้อมปุ่ม **Copy** และ **Open**

### คุณสมบัติ

- **อัปโหลดอัตโนมัติ**: รูปแบบ TXT อัปโหลดเมื่อการทดสอบเสร็จสิ้น
- **คัดลอกลิงก์**: คลิก 📋 Copy เพื่อคัดลอก URL ไปยังคลิปบอร์ด
- **เปิดลิงก์**: คลิก 🔗 Open เพื่อดูในเบราว์เซอร์
- **แชร์สาธารณะ**: ใครก็ตามที่มีลิงก์สามารถดูผลลัพธ์ได้

## ความต้องการ

### ความต้องการเซิร์ฟเวอร์

| เครื่องมือ | วัตถุประสงค์ | ติดตั้งอัตโนมัติ |
|------------|--------------|------------------|
| `dd` | ความเร็วเขียน/อ่านดิสก์ | มักติดตั้งมาก่อน |
| `ioping` | วัดเวลาแฝง I/O | ✅ ใช่ |
| `fio` | ทดสอบ IOPS แบบสุ่ม | ✅ ใช่ |
| `curl` | ทดสอบความเร็วเครือข่าย | มักติดตั้งมาก่อน |

### ตัวจัดการแพ็กเกจที่รองรับ

การติดตั้งอัตโนมัติทำงานกับ:
- **apt** (Debian, Ubuntu)
- **yum** (CentOS, RHEL)
- **dnf** (Fedora)
- **pacman** (Arch Linux)
- **apk** (Alpine Linux)
- **zypper** (openSUSE)

## การแก้ไขปัญหา

### การทดสอบดิสก์แสดงความเร็วที่ไม่สมจริง (5+ GB/s)

**สาเหตุ**: `/tmp` ถูก mount เป็น tmpfs (RAM disk)

**วิธีแก้ไข**: การทดสอบจะตรวจจับสิ่งนี้อัตโนมัติและใช้ไดเรกทอรี home แทน

### การทดสอบเครือข่ายใช้เวลานานเกินไป

**สาเหตุ**: บางภูมิภาคอาจช้าหรือเข้าถึงไม่ได้

**วิธีแก้ไข**: การทดสอบจะทดสอบหลายภูมิภาค ภูมิภาคที่ช้าจะหมดเวลาหลังจาก 30 วินาที

### "Permission Denied" เมื่อติดตั้งเครื่องมือ

**สาเหตุ**: ผู้ใช้ไม่มีสิทธิ์ sudo

**วิธีแก้ไข**: ขอให้ผู้ดูแลระบบเซิร์ฟเวอร์ติดตั้ง `fio` และ `ioping`:

```bash
# Debian/Ubuntu
sudo apt install fio ioping

# CentOS/RHEL
sudo yum install fio ioping

# Fedora
sudo dnf install fio ioping
```

### ข้อผิดพลาดส่งออก PNG "oklch"

**สาเหตุ**: html2canvas ไม่รองรับรูปแบบสี oklch

**วิธีแก้ไข**: แก้ไขแล้วใน v1.0.19 PNG ใช้สี RGB hex แล้ว

## ตัวอย่างเอาต์พุต

### ตัวอย่างรูปแบบ TXT

```
════════════════════════════════════════════════════════════
  MARIX SERVER BENCHMARK - my-server.com
  1/29/2026, 10:30:45 AM
════════════════════════════════════════════════════════════

┌────────────────────────────────────────────────────────────┐
│                    SYSTEM INFORMATION                      │
└────────────────────────────────────────────────────────────┘
  OS            : Ubuntu 22.04.3 LTS
  CPU           : AMD EPYC 7B13 64-Core Processor
  CPU Cores     : 4
  Memory        : 2.1 GB / 8.0 GB (26%)
  Disk          : 45 GB / 160 GB (28%)
  Virtualization: KVM

┌────────────────────────────────────────────────────────────┐
│                    DISK PERFORMANCE                        │
└────────────────────────────────────────────────────────────┘
  Sequential Write : 580 MB/s
  Sequential Read  : 1.2 GB/s
  I/O Latency      : 227 µs

  Random 4K IOPS (fio):
    Read IOPS   : 45,230
    Write IOPS  : 15,076
    Read BW     : 176.7 MB/s
    Write BW    : 58.9 MB/s

┌────────────────────────────────────────────────────────────┐
│                    NETWORK SPEED                           │
└────────────────────────────────────────────────────────────┘
  Singapore    : ↓ 892 Mbps  ↑ 456 Mbps  (12ms)
  Tokyo        : ↓ 756 Mbps  ↑ 389 Mbps  (45ms)
  Frankfurt    : ↓ 234 Mbps  ↑ 178 Mbps  (156ms)
  ...

────────────────────────────────────────────────────────────
  marix.dev | https://github.com/marixdev/marix
  Generated by Marix SSH Client v1.0.19
────────────────────────────────────────────────────────────
```

## หมายเหตุด้านความปลอดภัย

- การทดสอบรันคำสั่งบนเซิร์ฟเวอร์ระยะไกลผ่าน SSH
- ไม่มีข้อมูลถูกส่งไปยังเซิร์ฟเวอร์ภายนอกยกเว้น Speedtest.net (สำหรับทดสอบความเร็ว)
- การอัปโหลด paste.dev เป็นตัวเลือกและเริ่มต้นโดยผู้ใช้
- ไฟล์ทดสอบชั่วคราวจะถูกล้างอัตโนมัติหลังการทดสอบ
