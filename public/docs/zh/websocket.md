# WebSocket 客户端

连接到 WebSocket 服务器进行实时双向通信。非常适合测试 API、调试实时数据流或监控 WebSocket 服务。

## WebSocket 客户端界面

![WebSocket Interface](/websocket.png)

## 添加 WebSocket 服务器

1. 点击 **"添加新主机"**
2. 选择 **协议**：WebSocket (WSS)
3. 填写：
   - **名称**：连接的显示名称
   - **URL**：WebSocket 服务器地址
   - **请求头**：（可选）用于认证的自定义请求头
4. 点击 **创建**

### URL 格式

| 格式 | 示例 |
|--------|---------|
| 带协议 | `wss://api.example.com/ws` |
| 不带协议 | `api.example.com/ws`（自动添加 `wss://`） |
| 带端口 | `wss://localhost:8080/socket` |
| 带路径 | `wss://stream.example.com/v1/feed` |

> **注意：** 如果未指定协议，Marix 会自动添加 `wss://` 以建立安全的 WebSocket 连接。

## 连接

1. 在主机列表中双击 WebSocket 服务器
2. 等待连接（超时：15 秒）
3. 状态指示器显示连接状态

### 连接状态

| 状态 | 指示器 | 描述 |
|--------|-----------|-------------|
| 连接中 | 🟡 黄色 | 正在建立连接 |
| 已连接 | 🟢 绿色 | 可以发送/接收 |
| 已断开 | ⚪ 灰色 | 连接已关闭 |
| 错误 | 🔴 红色 | 连接失败 |

## 发送消息

1. 在底部的输入区域输入您的消息
2. 按 **Enter** 或点击 **发送**
3. 发送的消息显示带有 ↑ 箭头（绿色）

### 支持的消息格式

- 纯文本
- JSON（将自动格式化以便阅读）
- 任何字符串数据

## 接收消息

- 传入的消息自动显示，带有 ↓ 箭头（紫色）
- JSON 消息会自动格式化并正确缩进
- 时间戳显示每条消息的接收时间
- 消息历史每个会话最多保留 1000 条消息

## 控件

| 控件 | 功能 |
|---------|----------|
| **发送** | 向服务器发送消息 |
| **清除** | 清除视图中的所有消息 |
| **断开** | 关闭连接 |
| **重新连接** | 断开/错误后重新连接 |
| **主题选择器** | 更改查看器配色主题 |

## 键盘快捷键

| 快捷键 | 操作 |
|----------|--------|
| `Enter` | 发送消息 |
| `Shift+Enter` | 消息中换行 |

## 功能

### 自动滚动

- 默认启用
- 自动滚动到最新消息
- 关闭可查看旧消息
- 底部显示消息数量

### 主题支持

- 400+ 终端主题可用
- 点击标题中的主题选择器
- 主题应用于整个查看器
- 颜色适应明/暗主题

### JSON 格式化

当接收 JSON 消息时：
```json
{"event":"update","data":{"id":1,"value":"test"}}
```

Marix 自动格式化为：
```json
{
  "event": "update",
  "data": {
    "id": 1,
    "value": "test"
  }
}
```

## 使用场景

### API 测试

在开发过程中测试 WebSocket API：
- 发送测试载荷
- 监控响应
- 调试连接问题

### 实时数据监控

监控实时数据流：
- 股票价格更新
- 聊天应用
- 物联网传感器数据
- 游戏服务器事件

### 调试

调试 WebSocket 实现：
- 验证消息格式
- 检查连接稳定性
- 测试重连逻辑

## 故障排除

### 连接超时

- 检查 URL 是否正确
- 验证服务器是否正在运行
- 检查防火墙/代理设置
- 尝试显式使用 `wss://` 协议

### 连接被拒绝

- 服务器可能不接受连接
- 端口号错误
- SSL/TLS 证书问题
- 服务器需要认证头

### 消息发送失败

- 检查连接状态是否为"已连接"
- 验证消息格式是否符合服务器要求
- 检查服务器日志中的错误

### 意外断开连接

- 服务器可能已关闭连接
- 网络中断
- 服务器端空闲超时
- 点击 **重新连接** 恢复连接
