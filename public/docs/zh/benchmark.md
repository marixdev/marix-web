# 服务器性能测试

直接从 SSH 终端测试和测量服务器性能，提供全面的系统、磁盘和网络基准测试。

## 服务器性能测试界面

![服务器性能测试界面](/benchmark.png)

## 概述

服务器性能测试功能为您的远程服务器提供完整的性能分析，包括：

- **系统信息**：硬件和软件详情
- **磁盘性能**：顺序读写速度、I/O 延迟和随机 IOPS
- **网络速度**：多区域速度测试，包含下载、上传和延迟测量

## 使用方法

### 开始性能测试

1. 通过 SSH 连接到服务器
2. 点击终端底部的 **📊 Benchmark** 按钮
3. （可选）勾选 **"Upload to paste.dev"** 以在线分享结果
4. 点击 **Start Benchmark**

### 测试阶段

性能测试分为 4 个阶段：

| 阶段 | 描述 | 时长 |
|------|------|------|
| 1. 系统信息 | 收集操作系统、CPU、内存、磁盘信息 | ~2 秒 |
| 2. 磁盘测试 | 运行 dd、ioping 和 fio 测试 | ~45 秒 |
| 3. 网络测试 | 测试到 18 个全球区域的速度 | ~3-5 分钟 |
| 4. 完成 | 显示结果和导出选项 | - |

## 测试详情

### 系统信息

收集的数据包括：

| 字段 | 描述 |
|------|------|
| OS | 操作系统名称和版本 |
| Kernel | Linux 内核版本 |
| Architecture | CPU 架构（x86_64、arm64 等） |
| Hostname | 服务器主机名 |
| CPU Model | 处理器名称和规格 |
| CPU Cores | CPU 核心数 |
| CPU Frequency | 当前 CPU 频率 |
| Memory | 已用 / 总内存 |
| Swap | 已用 / 总交换空间 |
| Disk | 已用 / 总磁盘空间 |
| Uptime | 服务器运行时间 |
| Load Average | 1/5/15 分钟平均负载 |
| Virtualization | 虚拟机类型（KVM、VMware、OpenVZ 等） |

### 磁盘性能

#### 顺序写入/读取 (dd)

- **方法**：`dd if=/dev/zero of=test bs=64k count=16k conv=fdatasync`
- **运行次数**：3 次，取平均值以确保准确性
- **测试位置**：主目录（非 /tmp 以避免 tmpfs）
- **测量**：顺序吞吐量，单位为 MB/s 或 GB/s

#### I/O 延迟 (ioping)

- **方法**：`ioping -c 10 -q /`
- **测量**：磁盘 I/O 响应时间，单位为微秒
- **目标**：根文件系统，获取真实磁盘延迟

#### 随机 4K IOPS (fio)

- **方法**：fio 使用 4K 随机读写，64 队列深度
- **运行时间**：30 秒
- **测量**：
  - Read IOPS
  - Write IOPS
  - Read Bandwidth
  - Write Bandwidth

> **注意**：如果未安装 `fio` 或 `ioping`，测试工具将尝试自动安装。

### 网络速度

测试针对 18 个全球区域的 Speedtest.net 服务器进行：

| 区域 | 位置 |
|------|------|
| 亚洲 | 新加坡、东京、香港、首尔、孟买 |
| 欧洲 | 伦敦、法兰克福、巴黎、阿姆斯特丹 |
| 美洲 | 洛杉矶、纽约、芝加哥、多伦多、圣保罗 |
| 大洋洲 | 悉尼、奥克兰 |
| 中东/非洲 | 迪拜、约翰内斯堡 |

对于每个服务器，测试测量：
- **下载速度**：MB/s 或 Gbps
- **上传速度**：MB/s 或 Gbps
- **延迟**：往返时间，单位为毫秒

## 导出选项

测试完成后，您可以以多种格式导出结果：

### 🌐 HTML

带有样式布局的独立 HTML 文件。特点：
- 深色主题设计
- 响应式布局
- 所有测试数据以卡片形式展示
- 页脚包含 marix.dev 和 GitHub 链接

### 📋 JSON

结构化 JSON 数据，包含：
- 完整的测试结果
- 时间戳
- 包含网站和 GitHub 链接的元数据对象
- 适用于自动化的机器可读格式

### 🖼️ PNG

高分辨率图像截图：
- 2 倍缩放适配视网膜显示屏
- RGB 颜色（兼容 html2canvas）
- 包含所有部分
- 页脚带有品牌标识

### 📄 TXT

ASCII 艺术格式的文本文件：
- 表格使用制表符字符
- 便于复制粘贴
- 终端风格输出
- 页脚带有链接

## paste.dev 集成

一键在线分享您的测试结果：

### 工作原理

1. 在开始测试前勾选 **"Upload to paste.dev"**
2. 运行测试
3. 完成后，结果自动上传
4. 出现可分享链接，带有 **Copy** 和 **Open** 按钮

### 功能

- **自动上传**：测试完成时上传 TXT 格式
- **复制链接**：点击 📋 Copy 将 URL 复制到剪贴板
- **打开链接**：点击 🔗 Open 在浏览器中查看
- **公开分享**：任何拥有链接的人都可以查看结果

## 系统要求

### 服务器要求

| 工具 | 用途 | 自动安装 |
|------|------|----------|
| `dd` | 磁盘读写速度 | 通常已预装 |
| `ioping` | I/O 延迟测量 | ✅ 是 |
| `fio` | 随机 IOPS 测试 | ✅ 是 |
| `curl` | 网络速度测试 | 通常已预装 |

### 支持的包管理器

自动安装支持：
- **apt**（Debian、Ubuntu）
- **yum**（CentOS、RHEL）
- **dnf**（Fedora）
- **pacman**（Arch Linux）
- **apk**（Alpine Linux）
- **zypper**（openSUSE）

## 故障排除

### 磁盘测试显示不真实的速度（5+ GB/s）

**原因**：`/tmp` 被挂载为 tmpfs（内存盘）

**解决方案**：测试工具会自动检测并使用主目录代替。

### 网络测试耗时过长

**原因**：某些区域可能较慢或无法访问

**解决方案**：测试会检查多个区域。慢速区域将在 30 秒后超时。

### 安装工具时出现"Permission Denied"错误

**原因**：用户没有 sudo 权限

**解决方案**：请服务器管理员安装 `fio` 和 `ioping`：

```bash
# Debian/Ubuntu
sudo apt install fio ioping

# CentOS/RHEL
sudo yum install fio ioping

# Fedora
sudo dnf install fio ioping
```

### PNG 导出错误"oklch"

**原因**：html2canvas 不支持 oklch 颜色格式

**解决方案**：已在 v1.0.19 中修复。PNG 现在使用 RGB 十六进制颜色。

## 输出示例

### TXT 格式示例

```
════════════════════════════════════════════════════════════
  MARIX SERVER BENCHMARK - my-server.com
  1/29/2026, 10:30:45 AM
════════════════════════════════════════════════════════════

┌────────────────────────────────────────────────────────────┐
│                    SYSTEM INFORMATION                      │
└────────────────────────────────────────────────────────────┘
  OS            : Ubuntu 22.04.3 LTS
  CPU           : AMD EPYC 7B13 64-Core Processor
  CPU Cores     : 4
  Memory        : 2.1 GB / 8.0 GB (26%)
  Disk          : 45 GB / 160 GB (28%)
  Virtualization: KVM

┌────────────────────────────────────────────────────────────┐
│                    DISK PERFORMANCE                        │
└────────────────────────────────────────────────────────────┘
  Sequential Write : 580 MB/s
  Sequential Read  : 1.2 GB/s
  I/O Latency      : 227 µs

  Random 4K IOPS (fio):
    Read IOPS   : 45,230
    Write IOPS  : 15,076
    Read BW     : 176.7 MB/s
    Write BW    : 58.9 MB/s

┌────────────────────────────────────────────────────────────┐
│                    NETWORK SPEED                           │
└────────────────────────────────────────────────────────────┘
  Singapore    : ↓ 892 Mbps  ↑ 456 Mbps  (12ms)
  Tokyo        : ↓ 756 Mbps  ↑ 389 Mbps  (45ms)
  Frankfurt    : ↓ 234 Mbps  ↑ 178 Mbps  (156ms)
  ...

────────────────────────────────────────────────────────────
  marix.dev | https://github.com/marixdev/marix
  Generated by Marix SSH Client v1.0.19
────────────────────────────────────────────────────────────
```

## 安全说明

- 测试通过 SSH 在远程服务器上运行命令
- 除 Speedtest.net（用于速度测试）外，不会向外部服务器发送任何数据
- paste.dev 上传是可选的，由用户主动发起
- 临时测试文件在测试后自动清理
