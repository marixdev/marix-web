# 命令历史（命令回溯）

Marix 提供 **命令历史** 功能，为每个服务器存储和回溯之前执行的命令。这帮助您快速重新运行常用命令而无需再次输入。

## 命令历史界面

![Command History Interface](/cmh.png)

## 功能

- **每服务器历史**：每个服务器维护自己的命令历史
- **仅本地存储**：命令存储在本地，永远不会同步或备份
- **敏感数据过滤**：自动过滤包含密码、令牌或密钥的命令
- **LRU 清理**：自动删除旧命令（每服务器最多 50 条）
- **执行计数器**：追踪每个命令被使用的次数
- **搜索**：通过模糊搜索快速筛选命令

## 如何启用

命令历史 **默认禁用** 以保护隐私。要启用：

1. 打开 **设置**（侧边栏中的齿轮图标）
2. 导航到 **终端** 部分
3. 切换 **启用命令回溯**

## 使用方法

### 打开命令历史

在终端会话中，按：
- **`Tab`** 键，当终端输入为空时（光标在空行）
- 或点击终端工具栏中的 **历史** 按钮

### 键盘快捷键

| 按键 | 操作 |
|-----|--------|
| `Tab`（空输入） | 打开命令回溯弹窗 |
| `↑` / `↓` | 浏览命令 |
| `Enter` | 执行选中的命令 |
| `Escape` | 关闭弹窗 |
| `Delete` / `Backspace` | 删除选中的命令 |

### 弹窗操作

- **点击** 命令立即执行
- **搜索**：在搜索框中输入
- **删除** 单个命令用垃圾桶图标
- **保存为代码片段** 将命令转换为可重用的代码片段

## 隐私与安全

### 过滤的命令

匹配以下模式的命令 **永远不会存储**：

- 包含 `password`、`passwd`、`secret`、`token` 的命令
- 带有 `api_key` 或 `apikey` 的命令
- 带 `-p` 标志（密码）的 MySQL 命令
- `sudo -S`（标准输入密码）
- 使用 `sshpass` 或 `expect` 带密码的命令
- 带敏感值的环境变量导出

### 数据存储

- 存储在浏览器的 `localStorage`
- **永远不会同步** 到云服务
- **永远不会包含** 在备份中
- 清除浏览器数据时一并清除

### 清除历史

清除命令历史：

1. 打开 **设置** → **终端**
2. 点击 **清除命令历史**

或从命令回溯弹窗中按服务器清除。

## 限制

| 限制 | 值 |
|-------|-------|
| 每服务器最大命令数 | 50 |
| 最小命令长度 | 2 个字符 |

## 常见问题

### 为什么有些命令没有保存？

包含敏感模式（密码、令牌等）的命令出于安全考虑会被自动过滤。

### 我可以导出命令历史吗？

不可以，命令历史出于隐私原因特意设计为仅本地存储且不可导出。

### 命令历史会在设备之间同步吗？

不会，命令历史存储在本地且永远不会同步。
